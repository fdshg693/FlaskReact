# スクリプト・ツール活用ガイド

このドキュメントでは、開発を効率化するための各種スクリプトとツールの使い方を説明します。

---

## 📂 スクリプト・パッケージの構成

```
scripts/
├── github_copilot/          # GitHub Copilot関連
│   └── cli/                # CLI実行スクリプト
├── ai_review/              # AIレビュースクリプト
└── quality_check/          # 品質チェックスクリプト

packages/
└── github_template/         # GitHub Copilot テンプレート管理ツール
    └── src/github_template/
```

> **注意**: `packages/github_template` は `uv sync` で自動的にエディタブルインストールされます。

---

## 🤖 GitHub Copilot 関連ツール

GitHub Copilotのテンプレート管理ツールです。`uv sync` で自動的にインストールされます。

### コマンド一覧

| コマンド | 説明 |
|---------|------|
| `deploy-agents` | テンプレートからエージェント定義を生成 |
| `create-default-prompt` | デフォルトプロンプトを生成 |
| `deploy-prompts` | プロンプトをデプロイ |
| `create-task-from-agent` | エージェントからタスクファイルを生成 |

### 基本的な使い方

```bash
# エージェントのデプロイ
deploy-agents

# クリーンデプロイ（既存ファイルを削除してから）
deploy-agents --clean

# デフォルトプロンプトの生成
create-default-prompt

# プロンプトのデプロイ
deploy-prompts

# タスクファイルの生成
create-task-from-agent
```

### 並列実行スクリプト

```bash
bash scripts/github_copilot/cli/scripts.sh config.yaml
```

📖 **詳細仕様**: [../project_tech/github_copilot/deploy_scripts.md](../project_tech/github_copilot/deploy_scripts.md)

---

## 🔍 品質チェックスクリプト

### example ファイルチェッカー

**スクリプト**: `scripts/quality_check/example_checker.py`

`.example` ファイルの整合性をチェックします。

```bash
uv run python scripts/quality_check/example_checker.py
```

---

## 🧪 テスト関連

### pytest の実行

```bash
# すべてのテストを実行
uv run pytest

# 詳細モード
uv run pytest -v

# 簡潔モード
uv run pytest -q

# 特定のテストファイルを実行
uv run pytest tests/server/test_app_smoke.py

# 特定のテスト関数を実行
uv run pytest tests/server/test_app_smoke.py::test_home_endpoint

# カバレッジ付きで実行
uv run pytest --cov=src --cov-report=html

# 失敗したテストのみ再実行
uv run pytest --lf

# マーカーを使って実行
uv run pytest -m "not slow"
```

### VSCode タスクから実行

`.vscode/tasks.json` に定義されているタスク：

1. `Cmd+Shift+P` → `Tasks: Run Task`
2. `Run Tests` を選択

または、ショートカットキーを設定することも可能です。

---

## 🎨 コードフォーマット・リント

### Ruff による自動フォーマット

```bash
# すべてのPythonファイルをフォーマット
uv run ruff format .

# 特定のファイル/フォルダをフォーマット
uv run ruff format src/

# フォーマットのプレビュー（実際には変更しない）
uv run ruff format --check .
```

### Ruff によるリント

```bash
# リントエラーをチェック
uv run ruff check .

# 自動修正可能なエラーを修正
uv run ruff check --fix .

# 特定のルールを無視
uv run ruff check --ignore E501 .
```

### VSCode タスクから実行

1. `Cmd+Shift+P` → `Tasks: Run Task`
2. `Format Code` を選択

または、保存時に自動フォーマット（`settings.json` で設定済み）。

---

## 🔍 型チェック

### mypy による型チェック

```bash
# プロジェクト全体の型チェック
uv run mypy src/

# 特定のファイルをチェック
uv run mypy src/server/flask_entry.py

# より厳密なチェック
uv run mypy --strict src/

# キャッシュを使用して高速化
uv run dmypy run -- src/
```

### VSCode タスクから実行

1. `Cmd+Shift+P` → `Tasks: Run Task`
2. `Type Check` を選択

---

## 🔄 pre-commit フック

### pre-commit の実行

```bash
# コミット前に自動実行される（install済みの場合）
git commit -m "message"

# すべてのファイルに対して手動実行
uv run pre-commit run --all-files

# 特定のフックのみ実行
uv run pre-commit run ruff --all-files

# フックをスキップしてコミット（非推奨）
git commit -m "message" --no-verify
```

### pre-commit の設定

`.pre-commit-config.yaml` で定義されているフック：
- **trailing-whitespace**: 行末の空白を削除
- **end-of-file-fixer**: ファイル末尾に改行を追加
- **check-yaml**: YAMLファイルの構文チェック
- **ruff**: リント・フォーマット
- **mypy**: 型チェック

---

## 🤖 AIレビュー

詳細は [05_AI活用・自動化.md](./05_AI活用・自動化.md) を参照してください。

### ローカルでAIレビュー実行

```bash
# PRベースのレビュー
bash scripts/ai_review/generate_pr.sh
```

### GitHub Actions によるAIレビュー

PRを作成すると、自動的にAIレビューワークフローが実行されます（手動トリガも可）。

---

## 📊 その他の便利なコマンド

### 依存関係の可視化

```bash
# インストール済みパッケージ一覧
uv pip list

# 依存関係ツリー
uv pip tree

# 特定パッケージの情報
uv pip show <package-name>
```

### ログの確認

```bash
# 最新のログを表示
tail -f logs/app.log

# 特定の日付のログを検索
grep "2025-11-30" logs/app.log

# エラーログのみ抽出
grep "ERROR" logs/app.log
```

### データファイルの管理

```bash
# データフォルダのサイズ確認
du -sh data/

# 大きなファイルを検索
find data/ -type f -size +100M

# 古いログファイルを削除（30日以上前）
find logs/ -name "*.log" -mtime +30 -delete
```

---

## 🛠️ カスタムスクリプトの作成

新しいスクリプトを追加する場合：

### 1. スクリプトの配置

適切なカテゴリ配下に配置：
```
scripts/
├── github_copilot/
├── ai_review/
├── quality_check/
└── custom/              # 新しいカテゴリ
    └── my_script.py
```

### 2. 実行権限の付与（シェルスクリプトの場合）

```bash
chmod +x scripts/custom/my_script.sh
```

### 3. ドキュメント化

本ドキュメントに使い方を追記するか、スクリプト内にdocstringを記載：

```python
"""
My Custom Script

Usage:
    uv run python scripts/custom/my_script.py [options]

Options:
    --help: Show this help message
"""
```

---

## 🐛 トラブルシューティング

### スクリプトが見つからない

```bash
# 現在のディレクトリを確認
pwd

# プロジェクトルートに移動
cd /Users/seiwan/CodeStudy/FlaskReact
```

### 実行権限エラー

```bash
# 権限を確認
ls -l scripts/github_copilot/cli/scripts.sh

# 実行権限を付与
chmod +x scripts/github_copilot/cli/scripts.sh
```

### Python モジュールエラー

```bash
# 仮想環境がアクティブか確認
which python

# 依存関係を再インストール
uv sync
```

---

## 📚 次のステップ

スクリプトの使い方を理解したら、次のドキュメントを確認してください：

1. **AI活用・自動化**: [05_AI活用・自動化.md](./05_AI活用・自動化.md)
2. **開発規約**: [../dev_contract/INDEX.md](../dev_contract/INDEX.md)
3. **テスト戦略**: [../dev_contract/04_テスト戦略.md](../dev_contract/04_テスト戦略.md)
