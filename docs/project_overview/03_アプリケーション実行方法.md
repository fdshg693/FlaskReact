# アプリケーション実行方法

このドキュメントでは、FlaskとStreamlitアプリケーションの実行方法、デバッグ方法を説明します。

---

## 🚀 Flask アプリケーション

### 基本的な起動方法

```bash
uv run src/flask_entry.py
```

**アクセス先**: `http://localhost:8000`

### デバッグモードでの起動

```bash
# 環境変数でデバッグモード有効化
FLASK_DEBUG=1 uv run src/flask_entry.py
```

または、VSCodeのデバッグ機能を使用（後述）。

### ポート変更

デフォルトは8000番ポートですが、変更する場合：

```bash
# 環境変数で指定
FLASK_PORT=5000 uv run src/flask_entry.py
```

または、`src/flask_entry.py` を編集：

```python
if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000, debug=True)  # ポート番号を変更
```

---

## 🎨 Streamlit アプリケーション

### 基本的な起動方法

```bash
uv run streamlit run src/server/streamlit/{your_app_name}.py --server.port=8501
```

**アクセス先**: `http://localhost:8501`

### その他のオプション

```bash
# ブラウザを自動で開かない
uv run streamlit run src/server/streamlit/{your_app_name}.py --server.port=8501 --server.headless=true

# ファイル変更時に自動リロード（デフォルトで有効）
uv run streamlit run src/server/streamlit/{your_app_name}.py --server.runOnSave=true
```

---

## 🐛 VSCode デバッグ機能

### 1. デバッグ構成

`.vscode/launch.json` に以下のデバッグ構成が定義されています：
- 現在開いているPythonファイルをデバッグ
  - Flaswkアプリの起動のほか、単一のモジュールやスクリプトのデバッグに使用可能
- 現在開いているStreamlitスクリプトから、アプリをデバッグモードで起動
- 引数と共に、現在開いているPythonファイルをデバッグ（そこまで使うことはないはず）

### 2. デバッグの開始

1. VSCodeでデバッグしたいファイルを開く
2. ブレークポイントを設定（行番号の左をクリック）
3. F5キーを押す
  - 左サイドバーの「実行とデバッグ」から、実行構成を選択する（Streamlitアプリの場合・Pythonファイルの場合と基本2つ選択肢あり）
4. 実行が一時停止したら、変数の値を確認したり、ステップ実行を行う

### 3. デバッグコンソールの活用

デバッグ中に、デバッグコンソールで式を評価できます：

```python
# 変数の値を確認
print(variable_name)

# 式を評価
len(my_list)

# オブジェクトの属性を確認
vars(my_object)
```

---

## 📊 ログの確認

### ログの出力先

アプリケーションは `loguru` を使用してログを出力します。

- **コンソール**: 標準出力に表示
- **ファイル**: `logs/` フォルダ配下に保存（設定されている場合）

### ログレベルの変更

`.env` ファイルでログレベルを設定：

```env
LOG_LEVEL=DEBUG  # DEBUG, INFO, WARNING, ERROR, CRITICAL
```

---

## 🌐 エンドポイント一覧

### Flask アプリケーション

主要なエンドポイント：

| エンドポイント | 説明 | メソッド |
|-------------|------|---------|
| `/` | ホームページ | GET |
| `/home` | ホーム画面 | GET |
| `/csvTest` | CSV処理画面 | GET |
| `/image` | 画像処理画面 | GET |
| `/api/iris/predict` | Iris予測API | POST |
| `/api/image/process` | 画像処理API | POST |
| `/api/pdf/extract` | PDF抽出API | POST |

詳細は `src/server/flask_react_app/` のルート定義を参照してください。

### APIの使用例

#### Iris予測

```bash
curl -X POST http://localhost:8000/api/iris/predict \
  -H "Content-Type: application/json" \
  -d '{
    "sepal_length": 5.1,
    "sepal_width": 3.5,
    "petal_length": 1.4,
    "petal_width": 0.2
  }'
```

#### 画像処理

```bash
curl -X POST http://localhost:8000/api/image/process \
  -F "image=@/path/to/image.jpg" \
  -F "operation=grayscale"
```

---

## 🧪 テストの実行

### すべてのテストを実行

```bash
uv run pytest
```

### 特定のテストファイルを実行

```bash
uv run pytest tests/server/test_app_smoke.py
```

### カバレッジ付きで実行

```bash
uv run pytest --cov=src --cov-report=html
```

カバレッジレポートは `htmlcov/index.html` で確認できます。

### 詳細モード

```bash
# より詳細な出力
uv run pytest -v

# 簡潔な出力
uv run pytest -q

# 失敗したテストのみ再実行
uv run pytest --lf
```

---

## 🔄 開発中の便利な機能

### 自動リロード

Flaskは開発モードで自動リロードが有効です。ファイルを変更すると自動的にサーバーが再起動します。

```python
if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000, debug=True)  # debug=True
```

Streamlitもデフォルトで自動リロードが有効です。

### ホットリロード

フロントエンド（React/JS）の変更は、ブラウザをリロードするだけで反映されます。

---

## 📚 次のステップ

アプリケーションが正常に起動できたら、次のドキュメントを確認してください：

1. **スクリプト活用**: [04_スクリプト・ツール活用.md](./04_スクリプト・ツール活用.md)
2. **AI活用**: [05_AI活用・自動化.md](./05_AI活用・自動化.md)
3. **コーディング規約**: [../dev_contract/02_コーディング規約.md](../dev_contract/02_コーディング規約.md)
