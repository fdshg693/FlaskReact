# gh pr - Pull Request 操作コマンド

`gh pr` コマンドで Pull Request の作成、レビュー、マージなどを行います。

---

## 目次

- [gh pr create - 作成](#gh-pr-create---作成)
- [gh pr list - 一覧](#gh-pr-list---一覧)
- [gh pr view - 表示](#gh-pr-view---表示)
- [gh pr status - ステータス](#gh-pr-status---ステータス)
- [gh pr checkout - チェックアウト](#gh-pr-checkout---チェックアウト)
- [gh pr diff - 差分表示](#gh-pr-diff---差分表示)
- [gh pr review - レビュー](#gh-pr-review---レビュー)
- [gh pr merge - マージ](#gh-pr-merge---マージ)
- [gh pr close - クローズ](#gh-pr-close---クローズ)
- [gh pr reopen - 再オープン](#gh-pr-reopen---再オープン)
- [gh pr edit - 編集](#gh-pr-edit---編集)
- [gh pr comment - コメント](#gh-pr-comment---コメント)
- [gh pr ready - レビュー準備完了](#gh-pr-ready---レビュー準備完了)
- [gh pr checks - CI ステータス](#gh-pr-checks---ci-ステータス)

---

## gh pr create - 作成

新しい Pull Request を作成します。

### 基本構文

```bash
gh pr create [flags]
```

### 使用例

```bash
# 対話形式で作成
gh pr create

# タイトルと本文を指定
gh pr create --title "新機能追加" --body "機能の説明"

# ベースブランチを指定
gh pr create --base develop

# ドラフト PR として作成
gh pr create --draft

# レビュアーを指定
gh pr create --reviewer "user1,user2"

# 担当者を指定
gh pr create --assignee "@me"

# ラベルを付けて作成
gh pr create --label "enhancement" --label "needs-review"

# マイルストーンを指定
gh pr create --milestone "v1.0"

# Issue と関連付け（自動クローズ）
gh pr create --title "Fix bug" --body "Fixes #123"

# ブラウザで作成画面を開く
gh pr create --web

# 本文をファイルから読み込み
gh pr create --title "Feature" --body-file ./pr_body.md

# PR テンプレートを使用
gh pr create --template pull_request_template.md

# フォークから PR を作成
gh pr create --head my-fork:feature-branch

# コミットメッセージから自動生成
gh pr create --fill

# Web で作成後、PR をコピー
gh pr create --fill-first
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `-t, --title <string>` | タイトル |
| `-b, --body <string>` | 本文 |
| `-F, --body-file <file>` | 本文をファイルから |
| `-B, --base <branch>` | ベースブランチ |
| `-H, --head <branch>` | ヘッドブランチ |
| `-d, --draft` | ドラフトとして作成 |
| `-r, --reviewer <users>` | レビュアー |
| `-a, --assignee <users>` | 担当者 |
| `-l, --label <strings>` | ラベル |
| `-m, --milestone <name>` | マイルストーン |
| `-p, --project <name>` | プロジェクト |
| `-w, --web` | ブラウザで開く |
| `-f, --fill` | コミットから自動入力 |
| `--no-maintainer-edit` | メンテナー編集を禁止 |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

### PR 本文テンプレート例

```bash
gh pr create --title "機能追加: ユーザー認証" --body "## 概要
ユーザー認証機能を追加

## 変更内容
- ログイン画面の実装
- JWT トークン認証
- セッション管理

## テスト
- [x] 単体テスト
- [x] 結合テスト
- [ ] E2E テスト

## 関連 Issue
Closes #123

## スクリーンショット
（必要に応じて追加）"
```

---

## gh pr list - 一覧

Pull Request の一覧を表示します。

### 基本構文

```bash
gh pr list [flags]
```

### 使用例

```bash
# オープンな PR 一覧（デフォルト）
gh pr list

# クローズ/マージ済み PR
gh pr list --state closed
gh pr list --state merged

# すべての PR
gh pr list --state all

# 自分の PR
gh pr list --author "@me"

# レビュー待ちの PR
gh pr list --search "review:required"

# 自分がレビュアーの PR
gh pr list --search "review-requested:@me"

# ラベルでフィルタ
gh pr list --label "needs-review"

# ベースブランチでフィルタ
gh pr list --base main

# ヘッドブランチでフィルタ
gh pr list --head feature-branch

# ドラフトを除外
gh pr list --search "is:open draft:false"

# 表示件数を指定
gh pr list --limit 100

# JSON 形式で出力
gh pr list --json number,title,state,author

# 別リポジトリの PR
gh pr list --repo owner/repo
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `-s, --state <string>` | open/closed/merged/all |
| `-A, --author <user>` | 作成者でフィルタ |
| `-a, --assignee <user>` | 担当者でフィルタ |
| `-l, --label <strings>` | ラベルでフィルタ |
| `-B, --base <branch>` | ベースブランチでフィルタ |
| `-H, --head <branch>` | ヘッドブランチでフィルタ |
| `-S, --search <query>` | 検索クエリ |
| `-L, --limit <int>` | 表示件数 |
| `--json <fields>` | JSON 形式で出力 |
| `-q, --jq <expression>` | jq 式でフィルタ |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

### 便利な検索クエリ

```bash
# レビュー待ち（自分宛て）
gh pr list --search "is:open review-requested:@me"

# 変更要求済み
gh pr list --search "is:open review:changes_requested"

# 承認済みでマージ待ち
gh pr list --search "is:open review:approved"

# CI 失敗中
gh pr list --search "is:open status:failure"

# ドラフト
gh pr list --search "is:open draft:true"

# 1週間以上更新なし
gh pr list --search "is:open updated:<$(date -v-7d +%Y-%m-%d)"
```

---

## gh pr view - 表示

Pull Request の詳細を表示します。

### 基本構文

```bash
gh pr view [<number> | <url> | <branch>] [flags]
```

### 使用例

```bash
# 現在のブランチの PR を表示
gh pr view

# PR 番号で表示
gh pr view 123

# ブラウザで開く
gh pr view --web
gh pr view 123 --web

# コメントも表示
gh pr view 123 --comments

# JSON 形式で出力
gh pr view 123 --json number,title,body,state,reviewDecision

# ブランチ名で指定
gh pr view feature-branch
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `-w, --web` | ブラウザで開く |
| `-c, --comments` | コメントを表示 |
| `--json <fields>` | JSON 形式で出力 |
| `-q, --jq <expression>` | jq 式でフィルタ |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

### JSON フィールド例

```bash
# レビュー状態を確認
gh pr view 123 --json reviewDecision -q '.reviewDecision'

# CI ステータスを確認
gh pr view 123 --json statusCheckRollup -q '.statusCheckRollup'

# マージ可能性を確認
gh pr view 123 --json mergeable,mergeStateStatus
```

---

## gh pr status - ステータス

自分に関連する PR のステータスを表示します。

### 基本構文

```bash
gh pr status [flags]
```

### 使用例

```bash
# 関連 PR の概要を表示
gh pr status
```

### 出力例

```
Current branch
  #42 Feature update [feature-branch]
   - Checks passing - Review required

Created by you
  #38 Fix documentation [docs-update]
  - Checks pending - Approved

Requesting a code review from you
  #45 New feature [new-feature]
   - 3/4 checks failing - Review required
  #44 Bug fix [bugfix]
   - Checks passing - Changes requested
```

---

## gh pr checkout - チェックアウト

PR のブランチをローカルにチェックアウトします。

### 基本構文

```bash
gh pr checkout <number> [flags]
```

### 使用例

```bash
# PR 番号でチェックアウト
gh pr checkout 123

# ブランチ名を指定
gh pr checkout 123 --branch local-branch-name

# 強制チェックアウト（ローカル変更を破棄）
gh pr checkout 123 --force

# detached HEAD でチェックアウト
gh pr checkout 123 --detach

# PR URL でチェックアウト
gh pr checkout https://github.com/owner/repo/pull/123

# フォークからの PR もチェックアウト可能
gh pr checkout 456
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `-b, --branch <name>` | ローカルブランチ名 |
| `-f, --force` | 強制チェックアウト |
| `--detach` | detached HEAD |
| `--recurse-submodules` | サブモジュールも更新 |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

---

## gh pr diff - 差分表示

PR の差分を表示します。

### 基本構文

```bash
gh pr diff [<number> | <url> | <branch>] [flags]
```

### 使用例

```bash
# 現在のブランチの PR 差分
gh pr diff

# PR 番号で差分表示
gh pr diff 123

# カラー出力
gh pr diff 123 --color always

# パッチ形式で出力
gh pr diff 123 --patch

# ファイル名のみ表示
gh pr diff 123 --name-only

# ブラウザで開く
gh pr diff 123 --web
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `--color <when>` | カラー出力（always/never/auto） |
| `--patch` | パッチ形式 |
| `--name-only` | ファイル名のみ |
| `-w, --web` | ブラウザで開く |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

---

## gh pr review - レビュー

PR にレビューを行います。

### 基本構文

```bash
gh pr review [<number> | <url> | <branch>] [flags]
```

### 使用例

```bash
# 対話形式でレビュー
gh pr review 123

# 承認（APPROVE）
gh pr review 123 --approve

# 変更要求（REQUEST_CHANGES）
gh pr review 123 --request-changes

# コメントのみ（COMMENT）
gh pr review 123 --comment

# コメント付きで承認
gh pr review 123 --approve --body "LGTM! 良い実装です"

# 変更要求とコメント
gh pr review 123 --request-changes --body "セキュリティの問題があります"

# ファイルからコメントを読み込み
gh pr review 123 --approve --body-file ./review.md
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `-a, --approve` | 承認 |
| `-r, --request-changes` | 変更要求 |
| `-c, --comment` | コメントのみ |
| `-b, --body <string>` | レビューコメント |
| `-F, --body-file <file>` | ファイルから読み込み |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

### レビュー結果の確認

```bash
# レビュー状態を確認
gh pr view 123 --json reviews -q '.reviews[] | "\(.author.login): \(.state)"'

# レビュー決定を確認
gh pr view 123 --json reviewDecision -q '.reviewDecision'
# APPROVED, CHANGES_REQUESTED, REVIEW_REQUIRED
```

---

## gh pr merge - マージ

PR をマージします。

### 基本構文

```bash
gh pr merge [<number> | <url> | <branch>] [flags]
```

### 使用例

```bash
# 対話形式でマージ
gh pr merge 123

# マージコミットでマージ
gh pr merge 123 --merge

# スカッシュマージ
gh pr merge 123 --squash

# リベースマージ
gh pr merge 123 --rebase

# マージ後にブランチを削除
gh pr merge 123 --delete-branch

# CI チェックをスキップ
gh pr merge 123 --admin

# 自動マージを有効化（CI 通過後にマージ）
gh pr merge 123 --auto --squash

# 自動マージを無効化
gh pr merge 123 --disable-auto

# コミットメッセージを指定
gh pr merge 123 --squash --subject "feat: add new feature" --body "Detailed description"

# 現在のブランチの PR をマージ
gh pr merge --squash --delete-branch
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `-m, --merge` | マージコミット |
| `-s, --squash` | スカッシュマージ |
| `-r, --rebase` | リベースマージ |
| `-d, --delete-branch` | マージ後にブランチ削除 |
| `--auto` | 自動マージを有効化 |
| `--disable-auto` | 自動マージを無効化 |
| `--admin` | 管理者権限でマージ |
| `-t, --subject <string>` | コミットタイトル |
| `-b, --body <string>` | コミット本文 |
| `-F, --body-file <file>` | 本文をファイルから |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

### 自動マージワークフロー

```bash
# PR 作成と同時に自動マージ設定
gh pr create --fill
gh pr merge --auto --squash --delete-branch

# または一度に
gh pr create --fill && gh pr merge --auto --squash
```

---

## gh pr close - クローズ

PR をマージせずにクローズします。

### 基本構文

```bash
gh pr close <number> [flags]
```

### 使用例

```bash
# PR をクローズ
gh pr close 123

# コメント付きでクローズ
gh pr close 123 --comment "この方針は採用しないことになりました"

# ブランチも削除
gh pr close 123 --delete-branch
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `-c, --comment <string>` | クローズ時のコメント |
| `-d, --delete-branch` | ブランチも削除 |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

---

## gh pr reopen - 再オープン

クローズした PR を再オープンします。

### 基本構文

```bash
gh pr reopen <number> [flags]
```

### 使用例

```bash
# PR を再オープン
gh pr reopen 123

# コメント付きで再オープン
gh pr reopen 123 --comment "再検討の結果、採用することにしました"
```

---

## gh pr edit - 編集

PR を編集します。

### 基本構文

```bash
gh pr edit [<number> | <url> | <branch>] [flags]
```

### 使用例

```bash
# タイトルを変更
gh pr edit 123 --title "新しいタイトル"

# 本文を変更
gh pr edit 123 --body "新しい説明"

# ベースブランチを変更
gh pr edit 123 --base develop

# レビュアーを追加
gh pr edit 123 --add-reviewer "user1,user2"

# レビュアーを削除
gh pr edit 123 --remove-reviewer "old-reviewer"

# ラベルを追加/削除
gh pr edit 123 --add-label "ready-for-review"
gh pr edit 123 --remove-label "wip"

# 担当者を変更
gh pr edit 123 --add-assignee "@me"

# マイルストーンを設定
gh pr edit 123 --milestone "v2.0"

# 複数の変更を同時に
gh pr edit 123 \
  --title "更新: 機能追加" \
  --add-label "reviewed" \
  --remove-label "needs-review" \
  --add-assignee "@me"
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `-t, --title <string>` | タイトル |
| `-b, --body <string>` | 本文 |
| `-F, --body-file <file>` | 本文をファイルから |
| `-B, --base <branch>` | ベースブランチ |
| `--add-reviewer <users>` | レビュアーを追加 |
| `--remove-reviewer <users>` | レビュアーを削除 |
| `--add-label <strings>` | ラベルを追加 |
| `--remove-label <strings>` | ラベルを削除 |
| `--add-assignee <users>` | 担当者を追加 |
| `--remove-assignee <users>` | 担当者を削除 |
| `-m, --milestone <name>` | マイルストーン |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

---

## gh pr comment - コメント

PR にコメントを追加します。

### 基本構文

```bash
gh pr comment [<number> | <url> | <branch>] [flags]
```

### 使用例

```bash
# 対話形式でコメント
gh pr comment 123

# コメントを直接指定
gh pr comment 123 --body "確認しました"

# ファイルからコメント
gh pr comment 123 --body-file ./comment.md

# エディタでコメントを編集
gh pr comment 123 --editor

# ブラウザで開く
gh pr comment 123 --web

# 最後のコメントを編集
gh pr comment 123 --edit-last
```

---

## gh pr ready - レビュー準備完了

ドラフト PR をレビュー準備完了にします。

### 基本構文

```bash
gh pr ready [<number> | <url> | <branch>] [flags]
```

### 使用例

```bash
# ドラフト PR を準備完了に
gh pr ready 123

# 現在のブランチの PR を準備完了に
gh pr ready

# 特定リポジトリの PR
gh pr ready 123 --repo owner/repo
```

---

## gh pr checks - CI ステータス

PR の CI チェック状況を表示します。

### 基本構文

```bash
gh pr checks [<number> | <url> | <branch>] [flags]
```

### 使用例

```bash
# CI ステータスを表示
gh pr checks 123

# 現在のブランチの CI ステータス
gh pr checks

# CI が完了するまで待機
gh pr checks 123 --watch

# 失敗した場合にエラー終了
gh pr checks 123 --fail-fast

# 特定のチェックのみ表示
gh pr checks 123 --required

# ブラウザで開く
gh pr checks 123 --web
```

### 主なオプション

| オプション | 説明 |
|-----------|------|
| `--watch` | 完了まで監視 |
| `-i, --interval <duration>` | 監視間隔 |
| `--fail-fast` | 失敗時にエラー終了 |
| `--required` | 必須チェックのみ |
| `-w, --web` | ブラウザで開く |
| `-R, --repo <owner/repo>` | 対象リポジトリ |

### CI 完了を待ってマージ

```bash
# CI が通ったらマージ
gh pr checks 123 --watch && gh pr merge 123 --squash --delete-branch
```

---

## 実践的なワークフロー

### 機能開発からマージまで

```bash
# 1. ブランチ作成
git checkout -b feature/new-feature
# 開発...

# 2. コミット
git add .
git commit -m "feat: add new feature"

# 3. プッシュ
git push -u origin feature/new-feature

# 4. PR 作成
gh pr create --fill --draft

# 5. 開発継続...
git add .
git commit -m "fix: address review comments"
git push

# 6. レビュー準備完了
gh pr ready

# 7. レビュー状態を確認
gh pr status
gh pr view --json reviewDecision

# 8. CI 確認後マージ
gh pr checks --watch && gh pr merge --squash --delete-branch
```

### レビュアーとしてのワークフロー

```bash
# 1. レビュー待ちの PR を確認
gh pr list --search "review-requested:@me"

# 2. PR をチェックアウト
gh pr checkout 123

# 3. コードを確認
gh pr diff 123
# ローカルでテスト実行

# 4. レビュー投稿
gh pr review 123 --approve --body "LGTM! コードの品質が高いです"

# または変更要求
gh pr review 123 --request-changes --body "以下の点を修正してください..."
```

### 複数 PR の一括処理

```bash
# 承認済み PR を一括マージ
gh pr list --search "is:open review:approved" --json number -q '.[].number' | \
  xargs -I {} sh -c 'gh pr merge {} --squash --delete-branch'

# 古い PR をクローズ
gh pr list --search "is:open updated:<$(date -v-30d +%Y-%m-%d)" --json number -q '.[].number' | \
  xargs -I {} gh pr close {} --comment "長期間更新がないためクローズします"
```

---

## 参考

- [gh pr 公式マニュアル](https://cli.github.com/manual/gh_pr)
