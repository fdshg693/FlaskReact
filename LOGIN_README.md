# ログイン機能 (Login Functionality)

このドキュメントでは、FlaskReactアプリケーションに実装されたログイン機能について説明します。

## 概要

問題「ログインが上手くいかない」を解決するため、完全なログイン認証システムを実装しました。

## 実装された機能

### 🔐 バックエンド認証 (Flask)

- **セッションベース認証**: セキュアなセッションクッキーを使用
- **パスワードハッシュ化**: Werkzeugセキュリティ機能を使用
- **API エンドポイント**:
  - `POST /api/login` - ユーザーログイン
  - `POST /api/logout` - ユーザーログアウト
  - `GET /api/auth/status` - 認証状態確認
- **認証ミドルウェア**: `@login_required` デコレータ
- **保護されたAPI**: 画像解析、PDF処理などのエンドポイント
- **CORS設定**: 認証情報の共有に対応

### 🎨 フロントエンド認証 (React)

- **ログインフォーム**: エラーハンドリング付き
- **認証コンテキスト**: グローバル状態管理
- **ヘッダーコンポーネント**: ユーザー情報とログアウトボタン
- **自動認証チェック**: アプリ起動時の認証状態確認
- **保護されたコンテンツ**: 認証状態に基づく表示制御

## テスト用アカウント

```
ユーザー名: admin
パスワード: password123

ユーザー名: user  
パスワード: user123
```

## 使用方法

### 1. サーバー起動

```bash
# 簡易版サーバー（推奨）
python simple_server.py

# または完全版サーバー
python run_app.py
```

### 2. アクセス

- メインアプリケーション: http://127.0.0.1:8000/
- デモページ: http://127.0.0.1:8000/login-demo

### 3. ログイン手順

1. ブラウザでアプリケーションにアクセス
2. ログインフォームにユーザー名とパスワードを入力
3. 「ログイン」ボタンをクリック
4. 認証成功後、保護されたコンテンツにアクセス可能

## API使用例

### ログイン
```bash
curl -X POST http://127.0.0.1:8000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password123"}' \
  -c cookies.txt
```

### 認証状態確認
```bash
curl -X GET http://127.0.0.1:8000/api/auth/status \
  -b cookies.txt
```

### 保護されたAPIアクセス
```bash
curl -X POST http://127.0.0.1:8000/api/iris \
  -H "Content-Type: application/json" \
  -d '{"test":"data"}' \
  -b cookies.txt
```

### ログアウト
```bash
curl -X POST http://127.0.0.1:8000/api/logout \
  -b cookies.txt
```

## テスト

自動テストを実行:
```bash
python test_login.py
```

## セキュリティ機能

- パスワードのハッシュ化
- セキュアなセッション管理
- CSRF対策（必要に応じて拡張可能）
- 適切なCORS設定
- 認証エラーのログ記録

## ファイル構成

```
server/app.py                  # メインサーバー（認証機能付き）
simple_server.py              # 簡易サーバー（認証機能付き）
static/home/js/
  ├── AuthContext.jsx         # 認証コンテキスト
  ├── Login.jsx              # ログインフォーム
  ├── Header.jsx             # ヘッダー（ユーザー情報表示）
  └── App.jsx                # メインアプリ（認証統合）
static/login_demo.html        # スタンドアロンデモページ
test_login.py                # 自動テストスクリプト
```

## 今後の拡張案

- データベース統合（現在はメモリ内ストレージ）
- ユーザー登録機能
- パスワード変更機能
- 二要素認証
- JWT トークン認証
- ユーザー権限管理

## トラブルシューティング

### よくある問題

1. **CDN リソースがブロックされる**
   - 解決策: `/login-demo` ページを使用（外部依存なし）

2. **認証状態が保持されない**
   - 確認点: Cookieが有効になっているか
   - 確認点: CORSが正しく設定されているか

3. **APIエラー 401**
   - 確認点: ログイン状態を確認
   - 解決策: 再ログインを試行

### ログ確認

サーバーコンソールで認証アクティビティを確認できます:
- ログイン成功/失敗
- ユーザーのログアウト
- APIアクセスログ